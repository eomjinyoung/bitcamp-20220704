<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ex07</title>
</head>
<body>
<h1>AJAX - onreadystatechange</h1>
<button id="btn1">요청</button><br>
<textarea id="ta" cols="80" rows="10"></textarea>

<script>
"use strict"
// onreadystatechange
// => 비동기로 AJAX 요청을 하게 되면 
//    작업 상태가 바뀔 때 마다 onreadystatechange로 등록한 
//    메서드가 호출된다.
// => 작업 상태는 메서드가 호출될 때 마다 readyState 값을 검사해 보면 알 수 있다. 
// => readyState의 값:
//    0 : XMLHttpRequest 준비
//    1 : open() 호출됨 => 서버에 연결됨. 
//    2 : send() 호출됨 => 서버에 요청을 보낸 후 응답 상태와 헤더 값을 받음.
//    3 : 서버에서 콘텐트를 받고 있는 중. 
//        아직 responseText에는 완전한 데이터가 들어 있지 않음.
//        서버에서 받은 일부 데이터가 들어 있을 수는 있음.
//    4 : 서버에서 콘텐트를 모두 받음. 즉 응답이 완료됨.
//       
//
var ta = document.querySelector("#ta");

document.querySelector("#btn1").onclick = () => {
    var xhr = new XMLHttpRequest();

    // 서버에서 응답이 왔을 때 호출될 메서드를 등록한다.
    // 서버에 연결하기 전에 등록해야 한다.
    // 즉 open()을 호출하기 전에 등록해야 한다.
    xhr.onreadystatechange = () => {
        console.log("현재 요청 상태: ", xhr.readyState);
    };
    
    xhr.open("GET", "test3.jsp", true);
    console.log("open() 리턴함.");
    
    xhr.send();
    console.log("send() 리턴함.");
    
    // 비동기로 요청할 때는 서버에서 응답이 왔을 때 값을 꺼내도록 한다.
    // 서버에서 응답이 왔는지 알아내는 방법은?
    // => 현재의 요청 상태를 보고 받는 것이다.
    // => 위의 onreadystatechange() 함수 등록을 참고하라!
};

</script>
</body>
</html>





